<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<title> Page principale </title>
		<script>
		
			function isURL(str) { /* Permet de vérifier si c'est un URL conforme */
			  var pattern = new RegExp('^((ft|htt)ps?:\\/\\/)?'+ // Regarde le protocole genre http, https
			  '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // Regarde le nom de domaine et le nombre de lettre finale 
			  '((\\d{1,3}\\.){3}\\d{1,3}))'+ // Ou regarde si c'est pas une IPV4
			  '(\\:\\d+)?'+ // Regarde pour les ports
			  '(\\/[-a-z\\d%@_.~+&:]*)*'+ // Regarde pour les ports
			  '(\\?[;&a-z\\d%_.~+=-]*)?'+ // Regarde si il y a du querry dedans 
			  '(\\#[-a-z\\d_]*)?$','i'); // Ainsi que les fragements d'information précédé de #
			  return pattern.test(str);
			};
			
			function envoi(){ /* Création d'une annotation pour une URI */
				
				if (isURL(document.getElementById('IdURI').value)){
					var body = {"URI": document.getElementById('IdURI').value, 
								"Commentaire": document.getElementById('IdCommentaire').value};
					<!-- console.log(body); -->
					var route = "/annotation";
					fetch(route, {    method:'POST', 
									  body: JSON.stringify(body) ,
									  headers:{'Content-Type': 'application/json'}
									  //mode:"cors", 
								}).then((res) => res.text()).then((text) => {
																				document.getElementById('IdURI').value="";
																				document.getElementById('IdCommentaire').value="";
																				document.getElementById('IdRes').innerHTML = text;
																			});
				}
				else {
					document.getElementById('IdURI').value="";
					document.getElementById('IdRes').innerHTML="Veuillez rentrer une URI valide!";
				}
				
			};
			
			function envoiAnnot(){ /* Récupération d'une annotation d'une URI */
				
				var Annot = document.getElementById('IdAnnot').value;
				var FormatIdAnnot = document.getElementById('FormatIdAnnot').value;

				if (FormatIdAnnot=='json'){
					FormatIdAnnot='application/'+FormatIdAnnot;
				}
				else {
					FormatIdAnnot='text/'+FormatIdAnnot;
				}

				var route = "/IdAnnot/"+Annot;
				fetch(route, {method:'GET', 
							  headers : {'accept' : FormatIdAnnot}
							  });
							  
							/* .then((res) => res.text()).then((text) => {
							document.getElementById('IdRes').innerHTML = text;
							}); */
			
			};
			
			function envoiURI(){ /* Fonction qui permet la récupération des toutes les annotations d'une URI  */
				
				var AnnotURI = document.getElementById('AnnotURI').value;
				AnnotURI = AnnotURI.split('/').slice(2).join('/');
				var FormatAnnotURI = document.getElementById('FormatAnnotURI').value;
				
				if (FormatAnnotURI=='json'){
					FormatAnnotURI='application/'+FormatAnnotURI;
				}
				else {
					FormatAnnotURI='text/'+FormatAnnotURI;
				}

				var route = "/URI/"+AnnotURI;
				fetch(route, {method:'GET', 
							  headers : {'accept' : FormatAnnotURI}, mode:"cors", 
							  });
			};
			
			
			
			function envoiAllAnnot(){ /* Fonction qui permet la récupération de tout les annotations*/

				var FormatAllAnnot = document.getElementById('FormatAllAnnot').value;
				
				if (FormatAllAnnot=='json'){
					FormatAllAnnot='application/'+FormatAllAnnot;
				}
				else {
					FormatAllAnnot='text/'+FormatAllAnnot;
				}

				var route = "/AllAnnot"; /* Appel la route suivante qui va reveiller AllAnnot dans Index.js */
				fetch(route, {method:'GET', 
							  headers : {'accept' : FormatAllAnnot}
							  });
			};
			

		</script>
	</head>

	<!-- Début du corp du text -->

	<body>
		
		<h1>Ecrire commentaire</h1>
		<form autocomplete="off">
			<p>
				<label for="URI">URI :</label>
				<input type="text" name="URI" id="IdURI" placeholder="" size="30">
			</p>
			<p>
				<label for="Commentaire">Ajoutez commentaire</label><br>
				<textarea name="Commentaire" id="IdCommentaire" size="30"></textarea>
			</p>
			<p> 
				<button onclick="envoi()" type="button">Envoyer</button>
			</p>
		</form>
		
		<p id="IdRes">
		</p>
		
		<h1>Acceder à une annotation</h1>
		<form autocomplete="off">
			<p>
				<label for="Annot">Annot :</label>
				<input type="text" name="Annot" id="IdAnnot" placeholder="" size="30" maxlength="20">
			</p>
			<p>
				<label for="FormatIdAnnot">Choisissez le format de réponse</label><br>
				<select name="FormatIdAnnot" id="FormatIdAnnot">
					<option value="html">html</option>
					<option value="json">Json</option>
				</select>
			</p>
			<p> 
				<button onclick="envoiAnnot()" type="button">Envoyer</button> 
			</p>
		</form>
		
		
		<!-- <h1>Acceder à une annotation</h1> -->
		<!-- <form action="/IdAnnot" method="GET" autocomplete="off"> -->
			<!-- <p> -->
				<!-- <label for="Annot">Annot :</label> -->
				<!-- <input type="text" name="Annot" id="IdAnnot" placeholder="" size="30" maxlength="20"> -->
			<!-- </p> -->
			<!-- <p> -->
				<!-- <label for="FormatIdAnnot">Choisissez le format de réponse</label><br> -->
				<!-- <select name="FormatIdAnnot" id="FormatIdAnnot"> -->
					<!-- <option value="html">html</option> -->
					<!-- <option value="Json">Json</option> -->
				<!-- </select> -->
			<!-- </p> -->
			<!-- <p>  -->
				<!-- <input type="submit" value="Submit">   -->
			<!-- </p> -->
		<!-- </form> -->
		
	
		
		<!-- <h1>Acceder à toutes les annotations</h1> -->
		<!-- <form action="/AllAnnot" method="GET" autocomplete="off"> -->
			<!-- <p> -->
				<!-- <label for="FormatAllAnnot">Choisissez le format de réponse</label><br> -->
				<!-- <select name="FormatAllAnnot" id="FormatAllAnnot"> -->
					<!-- <option value="html">html</option> -->
					<!-- <option value="Json">Json</option> -->
				<!-- </select> -->
			<!-- </p> -->
			<!-- <p>  -->
				<!-- <input type="submit" value="Submit">   -->
			<!-- </p> -->
		<!-- </form> -->
		
		
		<h1>Acceder à toutes les annotations</h1> <!-- Section qui gère la partie récupération de toutes les annotations -->
		<form autocomplete="off">
			<p>
				<label for="FormatAllAnnot">Choisissez le format de réponse</label><br>
				<select name="FormatAllAnnot" id="FormatAllAnnot">
					<option value="html">html</option>
					<option value="json">Json</option>
				</select>
			</p>
			<p> 
				<button onclick="envoiAllAnnot()" type="button">Envoyer</button>  
			</p>
		</form>
		
		
		
		<!-- <h1>Acceder aux annotations d'une URI</h1> -->
		<!-- <form action="/URI" method="GET" autocomplete="off"> -->
			<!-- <p> -->
				<!-- <label for="AnnotURI">URI :</label> -->
				<!-- <input type="text" name="AnnotURI" id="AnnotURI" placeholder="" size="30"> -->
			<!-- </p> -->
			
			<!-- <p> -->
				<!-- <label for="FormatAnnotURI">Choisissez le format de réponse</label><br> -->
				<!-- <select name="FormatAnnotURI" id="FormatAnnotURI"> -->
					<!-- <option value="html">html</option> -->
					<!-- <option value="Json">Json</option> -->
				<!-- </select> -->
			<!-- </p> -->
			<!-- <p>  -->
				<!-- <input type="submit" value="Submit">   -->
			<!-- </p> -->
		<!-- </form> -->
		
		
		
		<h1>Acceder aux annotations d'une URI</h1>
		<form autocomplete="off">
			<p>
				<label for="AnnotURI">URI :</label>
				<input type="text" name="AnnotURI" id="AnnotURI" placeholder="" size="30">
			</p>
			
			<p>
				<label for="FormatAnnotURI">Choisissez le format de réponse</label><br>
				<select name="FormatAnnotURI" id="FormatAnnotURI">
					<option value="html">html</option>
					<option value="json">Json</option>
				</select>
			</p>
			<p> 
				<button onclick="envoiURI()" type="button">Envoyer</button>   
			</p>
		</form>
		
		

	</body>
</html>

